(function(global){var Deferred=function(){this._promise=new Promise};Deferred.prototype={promise:function(){return this._promise},resolve:function(value){this._promise.isResolved()||this._promise._resolve(value)},reject:function(reason){this._promise.isResolved()||this._promise._reject(reason)},notify:function(value){this._promise.isResolved()||this._promise._notify(value)}};var PROMISE_STATUS={PENDING:0,FULFILLED:1,REJECTED:-1};var Promise=function(resolver){this._value=undef;this._status=PROMISE_STATUS.PENDING;this._fulfilledCallbacks=[];this._rejectedCallbacks=[];this._progressCallbacks=[];if(resolver){var _this=this,resolverFnLen=resolver.length;resolver(function(val){_this.isResolved()||_this._resolve(val)},resolverFnLen>1?function(reason){_this.isResolved()||_this._reject(reason)}:undef,resolverFnLen>2?function(val){_this.isResolved()||_this._notify(val)}:undef)}};Promise.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==PROMISE_STATUS.PENDING},isFulfilled:function(){return this._status===PROMISE_STATUS.FULFILLED},isRejected:function(){return this._status===PROMISE_STATUS.REJECTED},then:function(onFulfilled,onRejected,onProgress,ctx){var defer=new Deferred;this._addCallbacks(defer,onFulfilled,onRejected,onProgress,ctx);return defer.promise()},"catch":function(onRejected,ctx){return this.then(undef,onRejected,ctx)},fail:function(onRejected,ctx){return this.then(undef,onRejected,ctx)},always:function(onResolved,ctx){var _this=this,cb=function(){return onResolved.call(this,_this)};return this.then(cb,cb,ctx)},progress:function(onProgress,ctx){return this.then(undef,undef,onProgress,ctx)},spread:function(onFulfilled,onRejected,ctx){return this.then(function(val){return onFulfilled.apply(this,val)},onRejected,ctx)},done:function(onFulfilled,onRejected,onProgress,ctx){this.then(onFulfilled,onRejected,onProgress,ctx).fail(throwException)},delay:function(delay){var timer,promise=this.then(function(val){var defer=new Deferred;timer=setTimeout(function(){defer.resolve(val)},delay);return defer.promise()});promise.always(function(){clearTimeout(timer)});return promise},timeout:function(timeout){var defer=new Deferred,timer=setTimeout(function(){defer.reject(Error("timed out"))},timeout);this.then(function(val){defer.resolve(val)},function(reason){defer.reject(reason)});defer.promise().always(function(){clearTimeout(timer)});return defer.promise()},_vow:true,_resolve:function(val){if(this._status!==PROMISE_STATUS.PENDING){return}if(val===this){this._reject(TypeError("Can't resolve promise with itself"));return}if(val&&!!val._vow){val.then(this._resolve,this._reject,this._notify,this);return}if(isObject(val)||isFunction(val)){var then;try{then=val.then}catch(e){this._reject(e);return}if(isFunction(then)){var _this=this,isResolved=false;try{then.call(val,function(val){if(isResolved){return}isResolved=true;_this._resolve(val)},function(err){if(isResolved){return}isResolved=true;_this._reject(err)},function(val){_this._notify(val)})}catch(e){isResolved||this._reject(e)}return}}this._fulfill(val)},_fulfill:function(val){if(this._status!==PROMISE_STATUS.PENDING){return}this._status=PROMISE_STATUS.FULFILLED;this._value=val;this._callCallbacks(this._fulfilledCallbacks,val);this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=undef},_reject:function(reason){if(this._status!==PROMISE_STATUS.PENDING){return}this._status=PROMISE_STATUS.REJECTED;this._value=reason;this._callCallbacks(this._rejectedCallbacks,reason);this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=undef},_notify:function(val){this._callCallbacks(this._progressCallbacks,val)},_addCallbacks:function(defer,onFulfilled,onRejected,onProgress,ctx){if(onRejected&&!isFunction(onRejected)){ctx=onRejected;onRejected=undef}else if(onProgress&&!isFunction(onProgress)){ctx=onProgress;onProgress=undef}var cb;if(!this.isRejected()){cb={defer:defer,fn:isFunction(onFulfilled)?onFulfilled:undef,ctx:ctx};this.isFulfilled()?this._callCallbacks([cb],this._value):this._fulfilledCallbacks.push(cb)}if(!this.isFulfilled()){cb={defer:defer,fn:onRejected,ctx:ctx};this.isRejected()?this._callCallbacks([cb],this._value):this._rejectedCallbacks.push(cb)}if(this._status===PROMISE_STATUS.PENDING){this._progressCallbacks.push({defer:defer,fn:onProgress,ctx:ctx})}},_callCallbacks:function(callbacks,arg){var len=callbacks.length;if(!len){return}var isResolved=this.isResolved(),isFulfilled=this.isFulfilled();nextTick(function(){var i=0,cb,defer,fn;while(i<len){cb=callbacks[i++];defer=cb.defer;fn=cb.fn;if(fn){var ctx=cb.ctx,res;try{res=ctx?fn.call(ctx,arg):fn(arg)}catch(e){defer.reject(e);continue}isResolved?defer.resolve(res):defer.notify(res)}else{isResolved?isFulfilled?defer.resolve(arg):defer.reject(arg):defer.notify(arg)}}})}};var staticMethods={cast:function(value){return vow.cast(value)},all:function(iterable){return vow.all(iterable)},race:function(iterable){return vow.anyResolved(iterable)},resolve:function(value){return vow.resolve(value)},reject:function(reason){return vow.reject(reason)}};for(var prop in staticMethods){staticMethods.hasOwnProperty(prop)&&(Promise[prop]=staticMethods[prop])}var vow={Deferred:Deferred,Promise:Promise,defer:function(){return new Deferred},when:function(value,onFulfilled,onRejected,onProgress,ctx){return vow.cast(value).then(onFulfilled,onRejected,onProgress,ctx)},fail:function(value,onRejected,ctx){return vow.when(value,undef,onRejected,ctx)},always:function(value,onResolved,ctx){return vow.when(value).always(onResolved,ctx)},progress:function(value,onProgress,ctx){return vow.when(value).progress(onProgress,ctx)},spread:function(value,onFulfilled,onRejected,ctx){return vow.when(value).spread(onFulfilled,onRejected,ctx)},done:function(value,onFulfilled,onRejected,onProgress,ctx){vow.when(value).done(onFulfilled,onRejected,onProgress,ctx)},isPromise:function(value){return isObject(value)&&isFunction(value.then)},cast:function(value){return vow.isPromise(value)?value:vow.resolve(value)},valueOf:function(value){return value&&isFunction(value.valueOf)?value.valueOf():value},isFulfilled:function(value){return value&&isFunction(value.isFulfilled)?value.isFulfilled():true},isRejected:function(value){return value&&isFunction(value.isRejected)?value.isRejected():false},isResolved:function(value){return value&&isFunction(value.isResolved)?value.isResolved():true},resolve:function(value){var res=vow.defer();res.resolve(value);return res.promise()},fulfill:function(value){return vow.when(value,null,function(reason){return reason})},reject:function(reason){return vow.when(reason,function(val){throw val})},invoke:function(fn,args){var len=Math.max(arguments.length-1,0),callArgs;if(len){callArgs=Array(len);var i=0;while(i<len){callArgs[i++]=arguments[i]}}try{return vow.resolve(callArgs?fn.apply(global,callArgs):fn.call(global))}catch(e){return vow.reject(e)}},all:function(iterable){var defer=new Deferred,isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),len=keys.length,res=isPromisesArray?[]:{};if(!len){defer.resolve(res);return defer.promise()}var i=len;vow._forEach(iterable,function(){if(!--i){var j=0;while(j<len){res[keys[j]]=vow.valueOf(iterable[keys[j++]])}defer.resolve(res)}},defer.reject,defer.notify,defer,keys);return defer.promise()},allResolved:function(iterable){var defer=new Deferred,isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),i=keys.length,res=isPromisesArray?[]:{};if(!i){defer.resolve(res);return defer.promise()}var onResolved=function(){--i||defer.resolve(iterable)};vow._forEach(iterable,onResolved,onResolved,defer.notify,defer,keys);return defer.promise()},allPatiently:function(iterable){return vow.allResolved(iterable).then(function(){var isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),rejectedPromises,fulfilledPromises,len=keys.length,i=0,key,promise;if(!len){return isPromisesArray?[]:{}}while(i<len){key=keys[i++];promise=iterable[key];if(vow.isRejected(promise)){rejectedPromises||(rejectedPromises=isPromisesArray?[]:{});isPromisesArray?rejectedPromises.push(promise.valueOf()):rejectedPromises[key]=promise.valueOf()}else if(!rejectedPromises){(fulfilledPromises||(fulfilledPromises=isPromisesArray?[]:{}))[key]=vow.valueOf(promise)}}if(rejectedPromises){throw rejectedPromises}return fulfilledPromises})},any:function(iterable){var defer=new Deferred,len=iterable.length;if(!len){defer.reject(Error());return defer.promise()}var i=0,reason;vow._forEach(iterable,defer.resolve,function(e){i||(reason=e);++i===len&&defer.reject(reason)},defer.notify,defer);return defer.promise()},anyResolved:function(iterable){var defer=new Deferred,len=iterable.length;if(!len){defer.reject(Error());return defer.promise()}vow._forEach(iterable,defer.resolve,defer.reject,defer.notify,defer);return defer.promise()},delay:function(value,delay){return vow.resolve(value).delay(delay)},timeout:function(value,timeout){return vow.resolve(value).timeout(timeout)},_forEach:function(promises,onFulfilled,onRejected,onProgress,ctx,keys){var len=keys?keys.length:promises.length,i=0;while(i<len){vow.when(promises[keys?keys[i]:i],onFulfilled,onRejected,onProgress,ctx);++i}}};var undef,nextTick=function(){var fns=[],enqueueFn=function(fn){return fns.push(fn)===1},callFns=function(){var fnsToCall=fns,i=0,len=fns.length;fns=[];while(i<len){fnsToCall[i++]()}};if(typeof setImmediate==="function"){return function(fn){enqueueFn(fn)&&setImmediate(callFns)}}if(typeof process==="object"&&process.nextTick){return function(fn){enqueueFn(fn)&&process.nextTick(callFns)}}if(global.postMessage){var isPostMessageAsync=true;if(global.attachEvent){var checkAsync=function(){isPostMessageAsync=false};global.attachEvent("onmessage",checkAsync);global.postMessage("__checkAsync","*");global.detachEvent("onmessage",checkAsync)}if(isPostMessageAsync){var msg="__promise"+ +new Date,onMessage=function(e){if(e.data===msg){e.stopPropagation&&e.stopPropagation();callFns()}};global.addEventListener?global.addEventListener("message",onMessage,true):global.attachEvent("onmessage",onMessage);return function(fn){enqueueFn(fn)&&global.postMessage(msg,"*")}}}var doc=global.document;if("onreadystatechange"in doc.createElement("script")){var createScript=function(){var script=doc.createElement("script");script.onreadystatechange=function(){script.parentNode.removeChild(script);script=script.onreadystatechange=null;callFns()};(doc.documentElement||doc.body).appendChild(script)};return function(fn){enqueueFn(fn)&&createScript()}}return function(fn){enqueueFn(fn)&&setTimeout(callFns,0)}}(),throwException=function(e){nextTick(function(){throw e})},isFunction=function(obj){return typeof obj==="function"},isObject=function(obj){return obj!==null&&typeof obj==="object"},toStr=Object.prototype.toString,isArray=Array.isArray||function(obj){return toStr.call(obj)==="[object Array]"},getArrayKeys=function(arr){var res=[],i=0,len=arr.length;while(i<len){res.push(i++)}return res},getObjectKeys=Object.keys||function(obj){var res=[];for(var i in obj){obj.hasOwnProperty(i)&&res.push(i)}return res};var defineAsGlobal=true;if(typeof exports==="object"){module.exports=vow;defineAsGlobal=false}if(typeof modules==="object"){modules.define("vow",function(provide){provide(vow)});defineAsGlobal=false}if(typeof define==="function"){define(function(require,exports,module){module.exports=vow});defineAsGlobal=false}defineAsGlobal&&(global.vow=vow)})(this);(function(global){function ApiError(type,message){this.name="ApiError";this.type=type;this.message=message;if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}ApiError.prototype=Object.create(Error.prototype,{constructor:{value:ApiError}});ApiError.BAD_REQUEST="BAD_REQUEST";ApiError.INTERNAL_ERROR="INTERNAL_ERROR";ApiError.NOT_FOUND="NOT_FOUND";var defineAsGlobal=true;if(typeof modules==="object"){modules.define("baby-loris-api-error",function(provide){provide(ApiError)});defineAsGlobal=false}if(typeof define==="function"){define("baby-loris-api-error",function(){return ApiError});defineAsGlobal=false}if(defineAsGlobal){global.bla=global.bla||{};global.bla.ApiError=ApiError}})(this);(function(global){function ApiError(type,message){this.name="ApiError";this.type=type;this.message=message;if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}ApiError.prototype=Object.create(Error.prototype,{constructor:{value:ApiError}});ApiError.BAD_REQUEST="BAD_REQUEST";ApiError.INTERNAL_ERROR="INTERNAL_ERROR";ApiError.NOT_FOUND="NOT_FOUND";var defineAsGlobal=true;if(typeof modules==="object"){modules.define("baby-loris-api-error",function(provide){provide(ApiError)});defineAsGlobal=false}if(typeof define==="function"){define("baby-loris-api-error",function(){return ApiError});defineAsGlobal=false}if(defineAsGlobal){global.bla=global.bla||{};global.bla.ApiError=ApiError}})(this);
